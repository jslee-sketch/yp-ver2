 ADMIN ONLY: BUYER/SELLER 응답 근거로 사용 금지

# ?뺤궛/而ㅻ????뺤콉 (Settlement & Actuator Commission)

?뺤궛? ?쒕룉???섍???留덉?留??④퀎?앸씪??
?쒓컙 ?뺤콉(cooling) + 遺꾩웳(Freeze) + 利앸튃??紐⑤몢 寃고빀?쒕떎.

---

## 1) 肄붾뱶 SSOT ?ъ씤???꾩옱 ?몃━)

- ?뺤궛 濡쒖쭅:
  - `app/logic_settlement.py`
- ?뺤궛 ?쇱슦??
  - `/settlements/...`
- 愿由ъ옄 ?뺤궛:
  - `app/routers/admin_settlements.py`
- ?먮룞 諛곗튂(?덈룄???묒뾽):
  - `scripts/run_settlement_batches.ps1`
  - ?ㅼ?以꾨윭 ?ㅽ뻾/?뺤씤: schtasks 湲곕컲

---

## 2) ?곹깭(?덉쓽 DB?먯꽌 ?ㅼ젣濡?愿痢〓맂 ?곹깭媛?

ReservationSettlement status ??
- READY
- APPROVED
- PAID
- PENDING
- HOLD

ActuatorCommission status ??
- PENDING
- PAID

(HOLD??refund/dispute? ?곌껐?섎뒗 Freeze ?곹깭濡?痍④툒)

---

## 3) ?뺤궛 諛곗튂 ?쒖? ?먮쫫

1) refresh-ready (?뺤궛 媛???곹깭 媛깆떊)
2) approve (?댁쁺 ?뱀씤 ?먮뒗 ?먮룞 ?뱀씤 ?뺤콉)
3) bulk-mark-paid (?ㅼ?湲?泥섎━)
4) 而ㅻ???怨꾩궛/吏湲?以鍮?
5) 媛먯궗濡쒓렇/諛곗튂濡쒓렇 ?④?

---

## 4) ?쒓컙 ?뺤콉 ?곌껐(?꾩닔)

- cooling_days: 遺꾩웳 媛??湲곌컙 ?숈븞 蹂대쪟
- payout_delay: cooling ??吏湲?吏??
- dispute 愿??異붽? 吏???덈떎硫?

=> time.md?먯꽌 ?ㅻ줈 SSOT?뷀븯怨?
?댁쁺 蹂寃쎌? admin_policy ?쇱슦?곕줈留??쒕떎.

---

## 5) ?묓릟??CS ?ㅻ챸 ?쒗뵆由?

- ?쒖젙???덉젙?쇄?= (?뺤젙??+ cooling + delay) 怨꾩궛 洹쇨굅 ?쒖떆
- ?쒕낫瑜??ъ쑀(HOLD)??= 遺꾩웳/利앸튃/?댁쁺寃??洹쇨굅 ?쒖떆
- ?쒖빱誘몄뀡??= ?대뼡 湲곗?湲덉븸(gmv)???대뼡 鍮꾩쑉濡?怨꾩궛?덈뒗吏 紐낆떆



# Settlement (?뺤궛) ?뺤콉 ??SSOT

??臾몄꽌??寃곗젣 ?꾨즺(PAID)???덉빟??????쒖젙???ㅻ깄??吏湲됱븸?앹쓣 怨꾩궛?섎뒗 洹쒖튃???뺤쓽?쒕떎.


## ?뺤궛 怨꾩궛??SSOT ?먯튃
- 寃곗젣 ?꾨즺(PAID) ?쒖젏??`fee_snapshot`??諛뺤젣?덇린 ?뚮Ц??
  ?댄썑 ?뺤콉??蹂寃쎈릺?대룄 怨쇨굅 嫄곕옒???숈씪??媛믪쑝濡??ы쁽 媛?ν빐???쒕떎.
- ?뺤궛 怨꾩궛? snapshot ?곗꽑, ?놁쑝硫?runtime policy濡??대갚?쒕떎.

---

## 1) ?뺤궛 怨꾩궛??SSOT

?뺤궛 怨꾩궛? ?ㅼ쓬 ?쒖꽌瑜??곕Ⅸ??

1) ?낅젰 湲덉븸: `paid_amount` (?뺤닔 ?먰솕)
2) PG ?섏닔猷? `pg_fee_amount = round(paid_amount * pg_fee_rate)`
3) ?뚮옯???섏닔猷?怨듦툒媛 湲곗?): `platform_fee = round(paid_amount * platform_fee_rate_for_level(level))`
4) VAT: `platform_fee_vat = round(platform_fee * vat_rate)`
   - **VAT??platform_fee?먮쭔 ?곸슜**?쒕떎.
5) ?뚮옯??珥?而ㅻ?????κ컪):  
   `platform_commission_amount = platform_fee + platform_fee_vat`
6) ???吏湲됱븸:  
   `seller_payout = paid_amount - pg_fee_amount - platform_commission_amount`
   - ?뚯닔媛 ?섎㈃ 0?쇰줈 ?대옩?꾪븳??

> ?섏닔猷뚯쑉(rate)? ?먯튃?곸쑝濡?**fee_snapshot**???곗꽑 ?ъ슜?섍퀬, ?놁쑝硫?runtime policy濡??대갚?쒕떎.

---

## 2) Settlement Snapshot Schema

?뺤궛 怨꾩궛 寃곌낵???ㅼ쓬 援ъ“濡??ㅻ，??肄붾뱶 諛섑솚/DB ??μ슜):

```json
{
  "paid_amount": 300000,
  "pg_fee_amount": 9900,
  "platform_fee": 10500,
  "platform_fee_vat": 1050,
  "platform_commission_amount": 11550,
  "seller_payout": 278550
}


